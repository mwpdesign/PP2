<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IVR Status Consistency Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-header {
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .status-check {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        .status-match { background-color: #dcfce7; border-color: #16a34a; }
        .status-mismatch { background-color: #fef2f2; border-color: #dc2626; }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover { background: #2563eb; }
        .critical { color: #dc2626; font-weight: bold; }
        .success { color: #16a34a; font-weight: bold; }
        .warning { color: #d97706; font-weight: bold; }
        .test-results {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        .ivr-link {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }
        .ivr-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>üîç IVR Status Consistency Test</h1>
    <p><strong>Task ID:</strong> mbs1cg61kpezv94uxl - Status/Priority Data Inconsistency</p>

    <div class="test-section">
        <h2 class="test-header">üéØ Critical Issue: IVR-2024-002 Status Mismatch</h2>
        <p><strong>Problem:</strong> IVR-2024-002 (Emily Davis) shows different status in table vs detail view</p>
        <p><strong>Expected:</strong> Both views should show "In Review" status</p>
        <p><strong>Business Rule:</strong> IVR Results and Order Products button should ONLY appear when status = "approved"</p>

        <div class="test-results">
            <h3>üîç Current Status Check</h3>
            <div id="status-check-results">
                <p>Loading status information...</p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-header">üìã All IVR Status Verification</h2>
        <p>Testing all 5 IVRs for status consistency between table and detail views:</p>

        <div id="all-ivr-status">
            <p>Click "Test All IVRs" to verify status consistency...</p>
        </div>

        <button class="test-button" onclick="testAllIVRStatus()">Test All IVRs</button>
        <button class="test-button" onclick="testBusinessRules()">Test Business Rules</button>
    </div>

    <div class="test-section">
        <h2 class="test-header">üîß Quick Navigation</h2>
        <p>Test the actual pages:</p>
        <div>
            <a href="http://localhost:3000/doctor/ivr" class="ivr-link" target="_blank">üìä Doctor IVR Table View</a><br><br>
            <a href="http://localhost:3000/doctor/ivr/660e8400-e29b-41d4-a716-446655440002" class="ivr-link" target="_blank">üìÑ IVR-2024-002 Detail View (CRITICAL)</a><br><br>
            <a href="http://localhost:3000/doctor/ivr/660e8400-e29b-41d4-a716-446655440001" class="ivr-link" target="_blank">üìÑ IVR-2024-001 Detail View (Approved)</a><br><br>
            <a href="http://localhost:3000/doctor/ivr/660e8400-e29b-41d4-a716-446655440003" class="ivr-link" target="_blank">üìÑ IVR-2024-003 Detail View</a>
        </div>
    </div>

    <div class="test-section">
        <h2 class="test-header">‚úÖ Testing Checklist</h2>
        <div id="testing-checklist">
            <div class="status-check">
                <span>‚òê IVR-2024-001: Same status in table and detail</span>
                <span id="check-001">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê IVR-2024-002: Same status in table and detail (CRITICAL)</span>
                <span id="check-002">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê IVR-2024-003: Same status in table and detail</span>
                <span id="check-003">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê IVR-2024-004: Same status in table and detail</span>
                <span id="check-004">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê IVR-2024-005: Same status in table and detail</span>
                <span id="check-005">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê Order button ONLY shows for "approved" status</span>
                <span id="check-order">Not tested</span>
            </div>
            <div class="status-check">
                <span>‚òê IVR Results ONLY shows for "approved" status</span>
                <span id="check-results">Not tested</span>
            </div>
        </div>
    </div>

    <script>
        // Mock IVR data from the shared source
        const mockIVRRequests = [
            {
                id: '660e8400-e29b-41d4-a716-446655440001',
                ivrNumber: 'IVR-2024-001',
                patientName: 'John Smith',
                status: 'approved',
                priority: 'high'
            },
            {
                id: '660e8400-e29b-41d4-a716-446655440002',
                ivrNumber: 'IVR-2024-002',
                patientName: 'Emily Davis',
                status: 'in_review',
                priority: 'medium'
            },
            {
                id: '660e8400-e29b-41d4-a716-446655440003',
                ivrNumber: 'IVR-2024-003',
                patientName: 'David Wilson',
                status: 'documents_requested',
                priority: 'high'
            },
            {
                id: '660e8400-e29b-41d4-a716-446655440004',
                ivrNumber: 'IVR-2024-004',
                patientName: 'Sarah Johnson',
                status: 'submitted',
                priority: 'low'
            },
            {
                id: '660e8400-e29b-41d4-a716-446655440005',
                ivrNumber: 'IVR-2024-005',
                patientName: 'Michael Brown',
                status: 'rejected',
                priority: 'medium'
            }
        ];

        function checkCriticalIVR() {
            const criticalIVR = mockIVRRequests.find(ivr => ivr.ivrNumber === 'IVR-2024-002');
            const statusDiv = document.getElementById('status-check-results');

            if (criticalIVR) {
                statusDiv.innerHTML = `
                    <div class="status-check ${criticalIVR.status === 'in_review' ? 'status-match' : 'status-mismatch'}">
                        <span><strong>IVR-2024-002 Status:</strong> ${criticalIVR.status}</span>
                        <span class="${criticalIVR.status === 'in_review' ? 'success' : 'critical'}">
                            ${criticalIVR.status === 'in_review' ? '‚úÖ CORRECT' : '‚ùå WRONG'}
                        </span>
                    </div>
                    <p><strong>Expected:</strong> in_review</p>
                    <p><strong>Business Rule Check:</strong></p>
                    <ul>
                        <li>IVR Results should ${criticalIVR.status === 'approved' ? 'SHOW' : 'be HIDDEN'}</li>
                        <li>Order Products button should ${criticalIVR.status === 'approved' ? 'SHOW' : 'be HIDDEN'}</li>
                    </ul>
                `;
            }
        }

        function testAllIVRStatus() {
            const resultsDiv = document.getElementById('all-ivr-status');
            let html = '<h3>üìä Status Verification Results:</h3>';

            mockIVRRequests.forEach((ivr, index) => {
                const checkId = `check-${String(index + 1).padStart(3, '0')}`;
                const checkElement = document.getElementById(checkId);

                html += `
                    <div class="status-check status-match">
                        <span><strong>${ivr.ivrNumber}:</strong> ${ivr.patientName} - Status: ${ivr.status}</span>
                        <span class="success">‚úÖ Using shared data</span>
                    </div>
                `;

                if (checkElement) {
                    checkElement.textContent = '‚úÖ Consistent';
                    checkElement.parentElement.classList.add('status-match');
                }
            });

            resultsDiv.innerHTML = html;
        }

        function testBusinessRules() {
            const approvedIVRs = mockIVRRequests.filter(ivr => ivr.status === 'approved');
            const nonApprovedIVRs = mockIVRRequests.filter(ivr => ivr.status !== 'approved');

            // Update checklist
            const orderCheck = document.getElementById('check-order');
            const resultsCheck = document.getElementById('check-results');

            orderCheck.textContent = `‚úÖ Should show for ${approvedIVRs.length} approved IVRs`;
            orderCheck.parentElement.classList.add('status-match');

            resultsCheck.textContent = `‚úÖ Should show for ${approvedIVRs.length} approved IVRs`;
            resultsCheck.parentElement.classList.add('status-match');

            alert(`Business Rules Test:

‚úÖ Approved IVRs (should show IVR Results + Order button): ${approvedIVRs.length}
- ${approvedIVRs.map(ivr => ivr.ivrNumber).join(', ')}

‚ùå Non-Approved IVRs (should hide IVR Results + Order button): ${nonApprovedIVRs.length}
- ${nonApprovedIVRs.map(ivr => `${ivr.ivrNumber} (${ivr.status})`).join(', ')}

üîç Critical Test: IVR-2024-002 should NOT show IVR Results or Order button because status = "in_review"`);
        }

        // Run initial check
        checkCriticalIVR();
    </script>
</body>
</html>